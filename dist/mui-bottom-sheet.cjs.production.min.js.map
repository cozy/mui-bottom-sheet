{"version":3,"file":"mui-bottom-sheet.cjs.production.min.js","sources":["../src/util.ts","../src/BottomSheet.tsx"],"sourcesContent":["/**\n * Find the closest value in an array to a given value\n * @param goal target value\n * @param numbers array of numbers to search through\n */\nexport const closest = (goal: number, numbers: number[]) =>\n  numbers.reduce((prev, pos) =>\n    Math.abs(pos - goal) < Math.abs(prev - goal) ? pos : prev\n  );\n\n/**\n * Find the next value in an array to a given value\n * @param goal target value\n * @param direction indicates whether to find for a higher or lower value\n * @param numbers array of numbers to search through\n */\nexport const next = (goal: number, direction: number, numbers: number[]) => {\n  if (direction > 0) {\n    const ascSortedNumbers = [...numbers].sort((a, b) => a - b);\n    return (\n      ascSortedNumbers.find(e => e >= goal) ||\n      ascSortedNumbers[ascSortedNumbers.length - 1]\n    );\n  } else {\n    const descSortedNumbers = [...numbers].sort((a, b) => b - a);\n    return (\n      descSortedNumbers.find(e => e <= goal) ||\n      descSortedNumbers[descSortedNumbers.length - 1]\n    );\n  }\n};\n\n/**\n * Check if a node is inside an other one\n * @param source - Reference node\n * @param target - Node in which we will search if the reference node is present\n * @returns boolean\n */\nexport const isInsideTag = (source: any, target: any) => {\n  let el = source;\n\n  while (el && el.parentNode) {\n    if (el === target) {\n      return true;\n    }\n    el = el.parentNode;\n  }\n\n  return false;\n};\n","import React, { FC, ReactElement, useEffect, useRef } from 'react';\nimport { a, useSpring, config, Globals } from 'react-spring';\nimport { useDrag } from 'react-use-gesture';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport { closest, next, isInsideTag } from './util';\n\nexport interface bottomSheetOptions {\n  /**\n   * Show backdrop that darkens as the sheet is pulled up. Defaults to true.\n   *\n   * @default true\n   */\n  backdrop?: boolean;\n\n  /**\n   * Background component behind sheet. Requires at least two `peekHeights`.\n   * @default null\n   */\n  background?: ReactElement;\n\n  /**\n   * Current peek index if you want to control the component.\n   * @default 0;\n   */\n  currentIndex?: number;\n\n  /**\n   * Sheet height when in closed state.\n   * @default 100\n   */\n  defaultHeight: number;\n\n  /**\n   * Whether to go allow sheet to go full screen. If false, sheet will max out at largest peekHeight.\n   * @default true\n   */\n  fullHeight: boolean;\n\n  /**\n   * Completely hides the sheet when true.\n   * @default false\n   */\n  hidden: boolean | number;\n\n  /**\n   * Called when the user interacts and moves the bottomsheet to a new peek height\n   */\n  onIndexChange?: (index: number) => void;\n\n  /**\n   * Sheet will stop at certain heights to reveal more info.\n   * @default []\n   */\n  peekHeights?: number[];\n\n  /**\n   * Which spring config to use for snapping the sheet\n   * @default config.stiff\n   */\n  springConfig: Record<string, any>;\n\n  /**\n   * User styles for root, background and backdrop.\n   * @default {root:{},background:{},backdrop:{}}\n   */\n  styles?: bottomSheetStyles;\n\n  /**\n   * Threshold for over-dragging the sheet before snapping to closest height.\n   * @default 70\n   */\n  threshold: number;\n\n  /**\n   * Prevents the sheet from being totally closed\n   * @default false\n   */\n  disabledClosing: boolean;\n\n  /**\n   * Defines how the sheet should be anchored on the snap point\n   * @default false\n   */\n  snapPointSeekerMode: string;\n\n  /**\n   * Remove animations\n   * @default false\n   */\n  skipAnimation: boolean;\n}\n\nexport interface BottomSheetProps extends Partial<bottomSheetOptions> {}\n\nexport interface bottomSheetStyles {\n  backdrop?: Record<string, any>;\n  background?: Record<string, any>;\n  root?: Record<string, any>;\n}\n\n/** Some sensible defaults */\nexport const defaultOptions = {\n  backdrop: true,\n  background: null,\n  defaultHeight: 100,\n  fullHeight: true,\n  hidden: false,\n  peekHeights: [],\n  springConfig: config.stiff,\n  styles: { root: {}, backdrop: {}, background: {} },\n  threshold: 70,\n  disabledClosing: false,\n  snapPointSeekerMode: 'close',\n  skipAnimation: false,\n};\n\nexport const BottomSheet: FC<BottomSheetProps> = props => {\n  /** Merge defaults and provided options */\n  const {\n    backdrop,\n    background,\n    currentIndex,\n    defaultHeight,\n    fullHeight,\n    hidden,\n    onIndexChange,\n    peekHeights,\n    springConfig,\n    styles: userStyles,\n    threshold,\n    disabledClosing,\n    snapPointSeekerMode,\n    skipAnimation,\n  } = {\n    ...defaultOptions,\n    ...props,\n  };\n\n  Globals.assign({ skipAnimation });\n\n  /** Generate stylesheet */\n  const styles: bottomSheetStyles = {\n    backdrop: {\n      position: 'fixed' as React.CSSProperties['position'],\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      zIndex: 1198,\n      backgroundColor: 'rgba(0,0,0,0.3)',\n    },\n    background: {\n      position: 'fixed' as React.CSSProperties['position'],\n      zIndex: 1199,\n      left: 0,\n      top: 0,\n      width: '100%',\n    },\n    root: {\n      background: '#fff',\n      boxShadow: '0 -10px 20px rgba(0,0,0,0.3)',\n      width: '100%',\n      minHeight: defaultHeight,\n      maxHeight: '100%',\n      position: 'fixed' as React.CSSProperties['position'],\n      left: 0,\n      top: 0,\n      zIndex: 1200,\n    },\n  };\n\n  /** generate stop position relative to window height */\n  const stopPosition = (relativeHeight: number) =>\n    window.innerHeight - relativeHeight;\n\n  /** Create array of possible stop positions */\n  const defaultPosition = stopPosition(defaultHeight);\n  const stops = [defaultPosition];\n\n  /** Track heights */\n  const [measureRef, { height }] = useMeasure({ polyfill: ResizeObserver });\n\n  let max = 0;\n  /** If it's taller than the window, clamp the stops at full screen */\n  if (height > window.innerHeight && fullHeight) {\n    stops.push(0);\n  }\n\n  /** If the el is smaller than the window and larger than the default, add it as a stop. */\n  if (height < window.innerHeight && height > defaultHeight) {\n    max = stopPosition(height);\n    stops.push(max);\n  }\n\n  /** Add peek heights if they are less than the max height.\n   * To don't mess with snap indexes we don't add the peek height if it already in the stops array\n   */\n  peekHeights?.forEach(peekHeight => {\n    if (peekHeight < height && peekHeight < window.innerHeight) {\n      if (!stops.includes(stopPosition(peekHeight))) {\n        stops.push(stopPosition(peekHeight));\n      }\n    }\n  });\n\n  /** By using stopPosition, y-axis is defined from top to bottom,\n  but in peekHeights context, y-axis is defined from bottom to top,\n  so we have to use descending sort here to have a proper matching between stops and snap indexes */\n  stops.sort((a, b) => b - a);\n\n  /** Track container scroll to prevent pulling when not at scrollTop */\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  /** Track animateable styles */\n  const [{ y }, set] = useSpring(() => ({\n    y: defaultPosition,\n  }));\n\n  /** Handle draging */\n  const bind = useDrag(\n    ({ last, cancel, movement: [, my], direction: [dx, dy], event }) => {\n      event?.stopPropagation();\n\n      if (event && event.type && containerRef) {\n        if (!isInsideTag(event.target, containerRef.current)) {\n          return;\n        }\n      }\n\n      /** If the drag is feeling more horizontal than vertical, cancel */\n      if (dx < -0.8 || dx > 0.8) {\n        cancel && cancel();\n      }\n\n      /** Prevent drag if container isn't at top of scroll */\n      if (containerRef?.current?.scrollTop) {\n        return;\n      }\n\n      /**\n       * Cancel the drag if we either hit the top of the screen\n       * or a certain threshold above the max height (Defaults to 70px)\n       */\n      if (my < 0 || my < Math.min(...stops) - threshold) {\n        cancel && cancel();\n      }\n\n      /**\n       * Cancel the drag if we hit the lowest snap point\n       */\n      if (disabledClosing && my > Math.max(...stops)) {\n        cancel && cancel();\n      }\n\n      /** On release, snap to the new stop position */\n      if (last) {\n        let newPosition: number = 0;\n        if (snapPointSeekerMode === 'close') newPosition = closest(my, stops);\n        if (snapPointSeekerMode === 'next') newPosition = next(my, dy, stops);\n\n        set({\n          y: newPosition,\n          config: springConfig,\n        });\n\n        /** Call onIndexChange if it's set */\n        onIndexChange &&\n          onIndexChange(stops.findIndex(stop => stop === newPosition));\n        return;\n      }\n\n      /** On each frame, set the y position */\n      set({\n        y: my,\n        config: { duration: 0 },\n      });\n    },\n    {\n      /**\n       * If the container has been scrolled, we want the sheet\n       * to begin pulling down once the users gets back to the\n       * top of the scroll. initialising the my position as the\n       * negative value of the current scroll sets it to zero\n       * when the user gets to the top of the scrollable area.\n       */\n      initial: () => [\n        0,\n        containerRef.current?.scrollTop\n          ? // @ts-ignore\n            -containerRef.current.scrollTop + Math.min(...stops)\n          : y.goal,\n      ],\n      bounds: { top: 0 },\n    }\n  );\n\n  /** If the hidden prop is true, hide the entire sheet off-screen */\n  useEffect(() => {\n    set({\n      y: hidden ? window.innerHeight + 30 : defaultPosition,\n      config: config.gentle,\n    });\n  }, [hidden, set, defaultPosition]);\n\n  /** Set display:none when the drawer is hidden. */\n  const display = y.to(py => (py < window.innerHeight + 30 ? 'block' : 'none'));\n\n  /**\n   * Lock the scroll of the bottom sheet while it hasn't been\n   * pulled to its maximum possible height.\n   */\n  const overflowY = y.to(v => (v > Math.min(...stops) ? 'hidden' : 'scroll'));\n\n  /** Aggregate main sheet props into an object for spreading */\n  const sheetStyle = {\n    y,\n    display,\n    overflowY,\n  };\n\n  /** Animated styles for the backdrop based off the y position */\n  const backdropActiveAt = [...stops]\n    .reverse()\n    .find(n => n !== defaultPosition && n < defaultPosition);\n\n  const backdropStyle = {\n    /** backdrop should only begin to fade in after first stop */\n    opacity: y.to([(backdropActiveAt as number) || 0, defaultPosition], [1, 0]),\n    /** Set display none when backdrop isn't show so you can interact with the page */\n    display: y.to(py => (py < defaultPosition && backdrop ? 'block' : 'none')),\n  };\n\n  /**\n   * Background is an image or carousel that slides up behind the main\n   * bottom sheet, similar to the venue images on Google maps.\n   */\n  const backgroundStyle = {\n    height: Math.min(...stops.filter(n => n > 0)),\n    y: y.to(\n      [...stops].reverse(),\n      stops.map((_stop, i, arr) =>\n        i === arr.length - 1 || i === arr.length - 2 ? window.innerHeight : 0\n      ),\n      'clamp'\n    ),\n  };\n\n  /**\n   * Handle controlled component changes\n   */\n  useEffect(() => {\n    if (currentIndex !== undefined && y.goal !== stops[currentIndex]) {\n      if (!stops[currentIndex]) {\n        console.warn('No stop exists for the index you set.');\n      }\n      set({\n        y: stops[currentIndex],\n        config: springConfig,\n      });\n    }\n  }, [currentIndex, stops, set, y, springConfig]);\n\n  return (\n    <>\n      <a.div\n        {...bind()}\n        ref={containerRef}\n        // @ts-ignore\n        style={{ ...styles.root, ...userStyles.root, y, ...sheetStyle }}\n      >\n        <div ref={measureRef}>{props.children}</div>\n      </a.div>\n      {background && (\n        <a.div\n          style={{\n            ...styles.background,\n            ...userStyles.background,\n            ...backgroundStyle,\n          }}\n          className=\"background\"\n        >\n          {background}\n        </a.div>\n      )}\n      <a.div\n        // @ts-ignore\n        style={{ ...styles.backdrop, ...userStyles.backdrop, ...backdropStyle }}\n      />\n    </>\n  );\n};\n"],"names":["defaultOptions","backdrop","background","defaultHeight","fullHeight","hidden","peekHeights","springConfig","config","stiff","styles","root","threshold","disabledClosing","snapPointSeekerMode","skipAnimation","props","currentIndex","onIndexChange","userStyles","Globals","assign","position","bottom","left","right","top","zIndex","backgroundColor","width","boxShadow","minHeight","maxHeight","stopPosition","relativeHeight","window","innerHeight","defaultPosition","stops","useMeasure","polyfill","ResizeObserver","measureRef","height","max","push","forEach","peekHeight","includes","sort","a","b","containerRef","useRef","useSpring","y","set","bind","useDrag","last","cancel","my","movement","direction","dx","dy","event","stopPropagation","type","source","target","el","parentNode","isInsideTag","current","_containerRef$current","scrollTop","Math","min","newPosition","goal","reduce","prev","pos","abs","numbers","ascSortedNumbers","find","e","length","descSortedNumbers","next","findIndex","stop","duration","initial","bounds","useEffect","gentle","display","to","py","overflowY","v","sheetStyle","backdropActiveAt","reverse","n","backdropStyle","opacity","backgroundStyle","filter","map","_stop","i","arr","undefined","console","warn","React","div","ref","style","children","className"],"mappings":"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"}